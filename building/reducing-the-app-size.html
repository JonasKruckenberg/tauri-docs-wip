<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Reducing the App Size - The Tauri Documentation WIP</title>
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../theme/ferris.css">
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../introduction.html">Introduction</a></li><li class="chapter-item expanded affix "><div>Draft</div></li><li class="chapter-item expanded affix "><a href="../prerequisites.html">Prerequisites</a></li><li class="chapter-item expanded affix "><div>Migrated</div></li><li class="chapter-item expanded "><a href="../quick-start/index.html"><strong aria-hidden="true">1.</strong> Quick Start</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../quick-start/html-css-js.html"><strong aria-hidden="true">1.1.</strong> HTML/CSS/JS</a></li><li class="chapter-item expanded "><a href="../quick-start/vite.html"><strong aria-hidden="true">1.2.</strong> Vite</a></li><li class="chapter-item expanded "><a href="../quick-start/webpack.html"><strong aria-hidden="true">1.3.</strong> Webpack</a></li></ol></li><li class="chapter-item expanded "><a href="../background/index.html"><strong aria-hidden="true">2.</strong> Background</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../background/process-model.html"><strong aria-hidden="true">2.1.</strong> Process Model</a></li><li class="chapter-item expanded "><a href="../background/inter-process-communication.html"><strong aria-hidden="true">2.2.</strong> Inter-Process Communication</a></li><li class="chapter-item expanded "><a href="../background/security/index.html"><strong aria-hidden="true">2.3.</strong> Security</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../background/security/context-isolation.html"><strong aria-hidden="true">2.3.1.</strong> Context Isolation</a></li></ol></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">3.</strong> Development</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">3.1.</strong> Configuration</div></li><li class="chapter-item expanded "><a href="../development/inter-process-communication.html"><strong aria-hidden="true">3.2.</strong> Inter-Process Communication</a></li><li class="chapter-item expanded "><a href="../development/windows-and-webviews.html"><strong aria-hidden="true">3.3.</strong> Windows &amp; Webviews</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">3.4.</strong> State Management</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">3.5.</strong> Tauri Plugins</div></li><li class="chapter-item expanded "><a href="../development/debugging.html"><strong aria-hidden="true">3.6.</strong> Debugging</a></li><li class="chapter-item expanded "><a href="../development/testing.html"><strong aria-hidden="true">3.7.</strong> Testing</a></li><li class="chapter-item expanded "><a href="../development/vms.html"><strong aria-hidden="true">3.8.</strong> Virtual Machines</a></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">4.</strong> Building</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="../building/building-your-application.html"><strong aria-hidden="true">4.1.</strong> Building your Application</a></li><li class="chapter-item expanded "><a href="../building/linux.html"><strong aria-hidden="true">4.2.</strong> Linux</a></li><li class="chapter-item expanded "><a href="../building/windows-installer.html"><strong aria-hidden="true">4.3.</strong> Windows Installer</a></li><li class="chapter-item expanded "><a href="../building/macos-bundle.html"><strong aria-hidden="true">4.4.</strong> macOS Bundle</a></li><li class="chapter-item expanded "><a href="../building/updater-artifacts.html"><strong aria-hidden="true">4.5.</strong> Updater Artifacts</a></li><li class="chapter-item expanded "><a href="../building/reducing-the-app-size.html" class="active"><strong aria-hidden="true">4.6.</strong> Reducing the App Size</a></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">5.</strong> Distributing</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="../distributing/windows.html"><strong aria-hidden="true">5.1.</strong> Windows</a></li><li class="chapter-item expanded "><a href="../distributing/macos.html"><strong aria-hidden="true">5.2.</strong> macOS</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">5.3.</strong> Linux</div></li><li class="chapter-item expanded "><a href="../distributing/updater.html"><strong aria-hidden="true">5.4.</strong> Updater</a></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">6.</strong> Examples</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="../examples/window-customization.html"><strong aria-hidden="true">6.1.</strong> Window Customization</a></li><li class="chapter-item expanded "><a href="../examples/native-application-menu.html"><strong aria-hidden="true">6.2.</strong> Native Application Menu</a></li><li class="chapter-item expanded "><a href="../examples/system-tray.html"><strong aria-hidden="true">6.3.</strong> System Tray</a></li><li class="chapter-item expanded "><a href="../examples/sidecar.html"><strong aria-hidden="true">6.4.</strong> Sidecar</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">6.5.</strong> Notifications</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">6.6.</strong> Keyboard Shortcuts</div></li><li class="chapter-item expanded "><a href="../examples/splashscreen.html"><strong aria-hidden="true">6.7.</strong> Splashscreen</a></li><li class="chapter-item expanded "><a href="../examples/icons.html"><strong aria-hidden="true">6.8.</strong> Icons</a></li><li class="chapter-item expanded "><a href="../examples/command-line-interface.html"><strong aria-hidden="true">6.9.</strong> Command Line Interface</a></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">7.</strong> Appendix</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">7.1.</strong> A - Useful Development Tools</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">7.2.</strong> B - How Tauri is Made</div></li><li class="chapter-item expanded "><a href="../appendix/version-tables.html"><strong aria-hidden="true">7.3.</strong> C - Version Tables</a></li><li class="chapter-item expanded "><a href="../appendix/json-schemas.html"><strong aria-hidden="true">7.4.</strong> D - JSON Schemas</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">The Tauri Documentation WIP</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/JonasKruckenberg/tauri-docs-wip" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/JonasKruckenberg/tauri-docs-wip/edit/main/src/building/reducing-the-app-size.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="reducing-the-app-size"><a class="header" href="#reducing-the-app-size">Reducing the App Size</a></h1>
<p>With Tauri, we are working to reduce the environmental footprint of
applications by using system resources where available, providing
compiled systems that don't need runtime evaluation, and offering
guides so that engineers can go even smaller without sacrificing
performance or security. The point is, by saving resources, we are
doing our part to help you help us save the planet -- which is the
only bottom line that companies in the 21st Century should care about.</p>
<p>So if you are interested in learning how to improve your app size and
performance, read on!</p>
<h3 id="you-cant-improve-what-you-cant-measure"><a class="header" href="#you-cant-improve-what-you-cant-measure">You can't improve what you can't measure</a></h3>
<p>Before you can optimize your app, you need to figure out what takes up
space in your app! Here are a couple of tools that can assist you with
that:</p>
<ul>
<li>
<p><strong><code>cargo-bloat</code></strong> - A rust utility to determine what takes the most
space in your app. It gives you an excellent, sorted overview of the
most significant rust functions.</p>
</li>
<li>
<p><strong><code>cargo-expand</code></strong> - <a href="https://doc.rust-lang.org/book/ch19-06-macros.html">Macros</a> make your rust code more concise and
easier to read, but they are also hidden size traps! Use
<a href="https://github.com/dtolnay/cargo-expand"><code>cargo-expand</code></a> to see what those macros generate
under the hood.</p>
</li>
<li>
<p><strong><code>rollup-plugin-visualizer</code></strong> - A tool that generates beautiful
(and insightful) graphs from your rollup bundle. Very convenient for
figuring out what JavaScript dependencies contribute to your final
bundle size the most.</p>
</li>
<li>
<p><strong><code>rollup-plugin-graph</code></strong> - You noticed a dependency included in
your final frontend bundle, but you are unsure why?
<a href="https://github.com/ondras/rollup-plugin-graph"><code>rollup-plugin-graph</code></a> generates graphviz
compatible visualizations of your entire dependency graph.</p>
</li>
</ul>
<p>These are just a couple of tools that you might use. Make sure to
check your frontend bundlers plugin list for more!</p>
<h2 id="checklist"><a class="header" href="#checklist">Checklist</a></h2>
<!-- prettier-ignore -->
<ul>
<li><a href="#1-minify-javascript">1. Minify Javascript</a></li>
<li><a href="#2-optimize-dependencies">2. Optimize Dependencies</a></li>
<li><a href="#3-optimize-images">3. Optimize Images</a></li>
<li><a href="#4-remove-unnecessary-custom-fonts">4. Remove Unnecessary Custom Fonts</a></li>
<li><a href="#5-allowlist-config">5. Allowlist Config</a></li>
<li><a href="#6-rust-build-time-optimizations">6. Rust Build-time Optimizations</a></li>
<li><a href="#7-stripping">7. Stripping</a></li>
<li><a href="#8-upx">8. UPX</a></li>
</ul>
<h2 id="1-minify-javascript"><a class="header" href="#1-minify-javascript">1. Minify Javascript</a></h2>
<h3 id="why"><a class="header" href="#why">Why?</a></h3>
<p>JavaScript makes up a large portion of a typical Tauri app, so it's
important to make the JavaScript as lightweight as possible.</p>
<h3 id="how"><a class="header" href="#how">How?</a></h3>
<p>You can choose among a plethora of JavaScript bundlers; popular
choices are <a href="https://vitejs.dev">Vite</a>, <a href="https://webpack.js.org">webpack</a>, and <a href="https://rollupjs.org/guide/en/">rollup</a>. All of them can produce
minified JavaScript if configured correctly, so please consult your
bundler documentation for specific options. Generally speaking;
however, you should make sure to:</p>
<ul>
<li>
<p><strong>Enable tree shaking</strong></p>
<p>This option removes unused JavaScript from your bundle. All popular
bundlers enable this by default.</p>
</li>
<li>
<p><strong>Enable minification</strong></p>
<p>Minification removes unnecessary whitespace, shortens variable
names, and applies other optimizations. Most bundlers enable this by
default; a notable exception is <a href="https://rollupjs.org/guide/en/">rollup</a>, where you need plugins
like <a href="https://github.com/TrySound/rollup-plugin-terser">rollup-plugin-terser</a> or <a href="https://github.com/TrySound/rollup-plugin-uglify">rollup-plugin-uglify</a>.</p>
<blockquote>
<p>Note: You can use minifiers like <a href="https://terser.org">terser</a> and <a href="https://esbuild.github.io">esbuild</a> as
standalone tools.</p>
</blockquote>
</li>
<li>
<p><strong>Disable source maps</strong></p>
<p>Source maps provide a pleasant developer experience when working
with languages that compile to JavaScript, such as <a href="https://www.typescriptlang.org">TypeScript</a>. As
source maps tend to be quite large, you must disable them when
building for production. They have no benefit to your end-user, so
it's effectively dead weight.</p>
</li>
</ul>
<h2 id="2-optimize-dependencies"><a class="header" href="#2-optimize-dependencies">2. Optimize Dependencies</a></h2>
<p>Many popular libraries have smaller and faster alternatives that you
can choose instead.</p>
<h3 id="why-1"><a class="header" href="#why-1">Why?</a></h3>
<p>Most libraries you use depend on many libraries themselves, so a
library that looks inconspicuous at first glance might add <strong>several
megabytes</strong> worth of code to your app.</p>
<h3 id="how-1"><a class="header" href="#how-1">How?</a></h3>
<p>You can use <a href="https://bundlephobia.com">Bundlephobia</a> to find the cost of JavaScript
dependencies. Inspecting the cost of rust dependencies is generally
harder since the compiler does many optimizations.</p>
<p>If you find a library that seems excessively large, google around,
chances are someone else already had the same thought and created an
alternative. A good example is <a href="https://momentjs.com">Moment.js</a> and it's <a href="https://github.com/you-dont-need/You-Dont-Need-Momentjs">Many
alternatives</a>.</p>
<p>But keep in mind: <strong>The best dependency is no dependency</strong>, meaning
that you should always prefer language builtins over 3rd party
packages.</p>
<h2 id="3-optimize-images"><a class="header" href="#3-optimize-images">3. Optimize Images</a></h2>
<h3 id="why-2"><a class="header" href="#why-2">Why?</a></h3>
<p>According to the <a href="https://httparchive.org">Http Archive</a>, images are the <a href="https://httparchive.org/reports/page-weight#bytesImg">biggest contributor
to website weight</a>. So if your app
includes have background images or icons, make sure to optimize them!</p>
<h3 id="how-2"><a class="header" href="#how-2">How?</a></h3>
<p>You can choose between a variety of manual options (<a href="https://www.gimp.org">GIMP</a>,
<a href="https://www.adobe.com/de/products/photoshop.html">Photoshop</a>, <a href="https://squoosh.app">Squoosh</a>) or plugins for your favorite frontend build
tools (<a href="https://github.com/JonasKruckenberg/imagetools">vite-imagetools</a>, <a href="https://github.com/vbenjs/vite-plugin-imagemin">vite-plugin-imagemin</a>,
<a href="https://github.com/webpack-contrib/image-minimizer-webpack-plugin">image-minimizer-webpack-plugin</a>).</p>
<blockquote>
<p>The <code>imagemin</code> library most of the plugins use is <a href="https://github.com/imagemin/imagemin/issues/385">officially
unmaintained</a>.</p>
</blockquote>
<ul>
<li>
<p><strong>Use modern image formats</strong></p>
<p>Formats such as <code>webp</code> or <code>avif</code> offer size reductions of <strong>up to
95%</strong> compared to jpeg while maintaining excellent visual accuracy.
You can use tools such as <a href="https://squoosh.app">Squoosh</a> to try different formats on your
images.</p>
</li>
<li>
<p><strong>Size images accordingly</strong></p>
<p>No one appreciates you shipping the 6K raw image with your app, so
make sure to size your image accordingly. Images that appear large
on-screen should be sized larger than images that take up less
screen space.</p>
</li>
<li>
<p><strong>Don't use Responsive Images</strong></p>
<p>In a Web Environment, you are supposed to use <a href="https://developer.mozilla.org/en-US/docs/Learn/HTML/Multimedia_and_embedding/Responsive_images">Responsive Images</a> to
load the correct image size for each user dynamically. You are not
building a simple website, though: All your images are already
downloaded. So using Responsive Images only bloat your app with
redundant copies.</p>
</li>
<li>
<p><strong>Remove Metadata</strong></p>
<p>Images that were taken straight from a camera or stock photo side
often include metadata about the Camera and Lens model or
Photographer. Not only are those wasted bytes, but metadata
properties can also hold potentially sensitive information such as
the time, day, and location of the photo.</p>
</li>
</ul>
<h2 id="4-remove-unnecessary-custom-fonts"><a class="header" href="#4-remove-unnecessary-custom-fonts">4. Remove Unnecessary Custom Fonts</a></h2>
<p>Consider not shipping custom fonts with your app and relying on system
fonts instead. If you must ship custom fonts, make sure they are in
modern, optimized formats such as <code>woff2</code>.</p>
<h3 id="why-3"><a class="header" href="#why-3">Why?</a></h3>
<p>Fonts can be pretty big, so using the fonts already included in the
Operating System reduces the footprint of your app. It also avoids
FOUT (Flash of Unstyled Text) and makes your app feel more &quot;native&quot;
since it uses the same font as all other apps.</p>
<p>If you must include custom fonts, make sure you include them in modern
formats such as <code>woff2</code> as those tend to be way smaller than legacy
formats.</p>
<h3 id="how-3"><a class="header" href="#how-3">How?</a></h3>
<p>Use so-called <strong>&quot;System Font Stacks&quot;</strong> in your CSS. There are a number
of variations, but here are 3 basic ones to get you started:</p>
<ul>
<li>
<p><strong>Sans-serif</strong></p>
<pre><code class="language-css">font-family: -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;,
  Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;,
  &quot;Segoe UI Emoji&quot;;
</code></pre>
</li>
<li>
<p><strong>Serif</strong></p>
<pre><code class="language-css">font-family: Iowan Old Style, Apple Garamond, Baskerville,
  Times New Roman, Droid Serif, Times, Source Serif Pro, serif, Apple
    Color Emoji, Segoe UI Emoji, Segoe UI Symbol;
</code></pre>
</li>
<li>
<p><strong>Monospace</strong></p>
<pre><code class="language-css">font-family: ui-monospace, SFMono-Regular, SF Mono, Menlo, Consolas,
  Liberation Mono, monospace;
</code></pre>
</li>
</ul>
<h2 id="5-allowlist-config"><a class="header" href="#5-allowlist-config">5. Allowlist Config</a></h2>
<p>You can reduce the size of your app by only enabling the Tauri API
features you need in the <code>allowlist</code> config.</p>
<h3 id="why-4"><a class="header" href="#why-4">Why?</a></h3>
<p>The <code>allowlist</code> config determines what API features to enable;
disabled features will <strong>not be compiled into your app</strong>. This is an
easy way of shedding some extra weight.</p>
<h3 id="how-4"><a class="header" href="#how-4">How?</a></h3>
<p>An example from a typical <code>tauri.conf.json</code>:</p>
<pre><code class="language-json">{
  &quot;tauri&quot;: {
    &quot;allowlist&quot;: {
      &quot;all&quot;: false,
      &quot;fs&quot;: {
        &quot;writeFile&quot;: true
      },
      &quot;shell&quot;: {
        &quot;execute&quot;: true
      },
      &quot;dialog&quot;: {
        &quot;save&quot;: true
      }
    }
  }
}
</code></pre>
<h2 id="6-rust-build-time-optimizations"><a class="header" href="#6-rust-build-time-optimizations">6. Rust Build-time Optimizations</a></h2>
<p>Configure your cargo project to take advantage of rusts size
optimization features. <a href="https://lifthrasiir.github.io/rustlog/why-is-a-rust-executable-large.html">Why is a rust executable large ?</a> provides an
excellent explanation on why this matters and an in-depth walkthrough.
At the same time, <a href="https://github.com/johnthagen/min-sized-rust">Minimizing Rust Binary Size</a> is more up-to-date and
has a couple of extra recommendations.</p>
<h3 id="why-5"><a class="header" href="#why-5">Why?</a></h3>
<p>Rust is notorious for producing large binaries, but you can instruct
the compiler to optimize the final executable's size.</p>
<h3 id="how-5"><a class="header" href="#how-5">How?</a></h3>
<p>Cargo exposes several options that determine how the compiler
generates your binary. The &quot;recommended&quot; options for Tauri apps are
these:</p>
<pre><code class="language-toml">[profile.release]
panic = &quot;abort&quot; # Strip expensive panic clean-up logic
codegen-units = 1 # Compile crates one after another so the compiler can optimize better
lto = true # Enables link to optimizations
opt-level = &quot;s&quot; # Optimize for binary size
</code></pre>
<blockquote>
<p>There is also <code>opt-level = &quot;z&quot;</code> available to reduce the resulting
binary size. <code>&quot;s&quot;</code> and <code>&quot;z&quot;</code> can sometimes be smaller than the
other, so test it with your application!</p>
<p>We've seen smaller binary sizes from <code>&quot;s&quot;</code> for Tauri example
applications, but real-world applications can always differ.</p>
</blockquote>
<p>For a detailed explanation of each option and a bunch more, refer to
the <a href="https://doc.rust-lang.org/cargo/reference/profiles.html">Cargo books Profiles section</a>.</p>
<h3 id="unstable-rust-compression-features"><a class="header" href="#unstable-rust-compression-features">Unstable Rust Compression Features</a></h3>
<blockquote>
<p>The following suggestions are all unstable features and require a
nightly toolchain. See the <a href="https://doc.rust-lang.org/cargo/reference/unstable.html#unstable-features">Unstable
Features</a> documentation for more
information on what this involves.</p>
</blockquote>
<p>The following methods involve using unstable compiler features and
require the rust nightly toolchain. If you don't have the nightly
toolchain + <code>rust-src</code> nightly component added, try the following:</p>
<pre><code class="language-bash">rustup toolchain install nightly
rustup component add rust-src --toolchain nightly
</code></pre>
<p>The Rust Standard Library comes precompiled. This means rust is faster
to install, but also that the compiler can't optimize the Standard
Library. You can apply the optimization options for the rest of your
binary + dependencies to the std with an unstable flag. This flag
requires specifying your target, so know the target triple you are
targeting.</p>
<pre><code class="language-bash">cargo +nightly build --release -Z build-std --target x86_64-unknown-linux-gnu
</code></pre>
<p>If you are using <code>panic = &quot;abort&quot;</code> in your release profile
optimizations, you need to make sure the <code>panic_abort</code> crate is
compiled with std. Additionally, an extra std feature can further
reduce the binary size. The following applies both:</p>
<pre><code class="language-bash">cargo +nightly build --release -Z build-std=std,panic_abort -Z build-std-features=panic_immediate_abort --target x86_64-unknown-linux-gnu
</code></pre>
<p>See the unstable documentation for more details about
<a href="https://doc.rust-lang.org/cargo/reference/unstable.html#build-std"><code>-Z build-std</code></a> and
<a href="https://doc.rust-lang.org/cargo/reference/unstable.html#build-std-features"><code>-Z build-std-features</code></a>.</p>
<h2 id="7-stripping"><a class="header" href="#7-stripping">7. Stripping</a></h2>
<p>Use strip utilities to remove debug symbols from your compiled app.</p>
<h3 id="why-6"><a class="header" href="#why-6">Why?</a></h3>
<p>Your compiled app includes so-called &quot;Debug Symbols&quot; that include
function and variable names. Your end-users will probably not care
about Debug Symbols, so this is a pretty surefire way to save some
bytes!</p>
<h3 id="how-6"><a class="header" href="#how-6">How?</a></h3>
<p>The easiest way is to use the famous <code>strip</code> utility to remove this
debugging information.</p>
<pre><code class="language-bash">strip target/release/my_application
</code></pre>
<p>See your local <code>strip</code> manpage for more information and flags that can
be used to specify what information gets stripped out from the binary.</p>
<blockquote>
<p>Rust 1.59 now has a builtin version of <code>strip</code>! <br> It can be
enabled by adding the following to your <code>Cargo.toml</code>:</p>
<pre><code class="language-toml">[profile.release]
strip = true  # Automatically strip symbols from the binary.
</code></pre>
</blockquote>
<!-- TODO: add a note that strip if builtin with rust >= 1.59 -->
<h2 id="8-upx"><a class="header" href="#8-upx">8. UPX</a></h2>
<p>UPX, <strong>Ultimate Packer for eXecutables</strong>, is a dinosaur amongst the
binary packers. This 23-year old, well-maintained piece of kit is
GPL-v2 licensed with a pretty liberal usage declaration. Our
understanding of the licensing is that you can use it for any purposes
(commercial or otherwise) without needing to change your license
unless you modify the source code of UPX.</p>
<h3 id="why-7"><a class="header" href="#why-7">Why?</a></h3>
<p>Maybe your target audience has very slow internet, or your app needs
to fit on a tiny USB stick, and all the above steps haven't resulted
in the savings you need. Fear not, as we have one last trick up our
sleeves:</p>
<p><a href="https://github.com/upx/upx">UPX</a> compresses your binary and creates a self-extracting executable
that decompresses itself at runtime.</p>
<h3 id="how-7"><a class="header" href="#how-7">How?</a></h3>
<blockquote>
<p>You should know that this technique might flag your binary as a
virus on Windows and macOS - so use at your own discretion, and as
always, validate with <a href="https://frida.re/docs/home/">Frida</a> and do real distribution testing!</p>
</blockquote>
<h4 id="usage-on-macos"><a class="header" href="#usage-on-macos">Usage on macOS</a></h4>
<pre><code class="language-bash">brew install upx
yarn tauri build
upx --ultra-brute src-tauri/target/release/bundle/macos/app.app/Contents/macOS/app

                        Ultimate Packer for eXecutables
                            Copyright (C) 1996 - 2018
UPX 3.95        Markus Oberhumer, Laszlo Molnar &amp; John Reiser   Aug 26th 2018

        File size         Ratio      Format      Name
    --------------------   ------   -----------   -----------
    963140 -&gt;    274448   28.50%   macho/amd64   app
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../building/updater-artifacts.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                            <a rel="next" href="../distributing/windows.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../building/updater-artifacts.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a rel="next" href="../distributing/windows.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        <script type="text/javascript" src="../theme/mermaid.min.js"></script>
        <script type="text/javascript" src="../theme/mermaid-init.js"></script>
        <script type="text/javascript" src="../theme/ferris.js"></script>
    </body>
</html>
